{% extends 'base.html' %}

{% block title %}Trang chủ - Comic Analyzer{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 offset-lg-2">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h1 class="h3 mb-0"><i class="fas fa-spider me-2"></i>Crawler & Phân tích truyện tranh</h1>
            </div>
            <div class="card-body">
                <p class="lead">Chọn website truyện tranh để bắt đầu crawl dữ liệu:</p>
                
                <form action="{{ url_for('crawl') }}" method="post" id="crawl-form">
                    <div class="mb-3">
                        <label for="website" class="form-label">Website:</label>
                        <select class="form-select" id="website" name="website" required>
                            <option value="">-- Chọn website --</option>
                            {% for website in websites %}
                                <option value="{{ website.id }}">{{ website.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="pages" class="form-label">Số trang cần crawl:</label>
                        <input type="number" class="form-control" id="pages" name="pages" min="1" max="50" value="3" required>
                        <div class="form-text">Số trang càng nhiều, thời gian crawl càng lâu. Khuyến nghị: 3-5 trang.</div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-play me-2"></i>Bắt đầu Crawl
                        </button>
                    </div>
                </form>
            </div>
            <div class="card-footer text-muted">
                <div class="row text-center">
                    <div class="col-md-4">
                        <div class="feature">
                            <i class="fas fa-robot fa-2x mb-2"></i>
                            <h5>Crawl thông minh</h5>
                            <p class="small">Thu thập dữ liệu từ nhiều web truyện tranh phổ biến</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature">
                            <i class="fas fa-brain fa-2x mb-2"></i>
                            <h5>Phân tích sentiment</h5>
                            <p class="small">Sử dụng AI để phân tích cảm xúc từ bình luận</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <h5>Đánh giá khách quan</h5>
                            <p class="small">Xếp hạng truyện dựa trên nhiều tiêu chí khác nhau</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('crawl-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        
        fetch('{{ url_for("crawl") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success' && data.redirect) {
                // Lưu dữ liệu vào localStorage để sử dụng ở trang tiếp theo
                localStorage.setItem('crawl_data', JSON.stringify(data.data));
                window.location.href = data.redirect;
            } else {
                alert(data.message || 'Có lỗi xảy ra');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Có lỗi xảy ra khi xử lý yêu cầu');
        });
    });
</script>
{% endblock %}